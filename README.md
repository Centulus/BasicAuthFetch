# Crunchyroll Basic Auth Generator

Generate Basic Auth credentials (Base64 pair + User‑Agent) for the Crunchyroll Android app (Mobile or Android TV) from a local package you provide.
## How It Works

1. You provide a package path (APK/XAPK/APKM/APKS/ZIP) or a folder with APKs (e.g. extracted XAPK).
2. A fast classifier determines if it’s a single APK or a packaged bundle; bundles are extracted, single APKs are used directly.
3. The APK is decompiled with ApkTool (auto‑installed into `apktool/` if missing).
4. Credentials are found by scanning smali for known patterns.
5. Version is read from `apktool.yml` (generated by ApkTool):
	- Mobile: `versionName` (e.g. `3.92.3`)
	- TV: `versionName_versionCode` (e.g. `3.47.1_22278`)
6. A JSON file is generated with Base64 auth, User‑Agent, and app version.
7. A credential summary text file is written, including validation results.

## Modes

The script supports three behaviors:

* Mobile (`--mobile`) → outputs `latest-mobile.json` + `crunchyroll_credentials_mobile_v<versionName>.txt`.
* TV (`--tv`) → use an Android TV APK/bundle; outputs `latest-tv.json` + `crunchyroll_credentials_tv_v<versionName_versionCode>.txt`.
* Auto‑detected (default) → reads the decompiled manifest to decide TV (LEANBACK_LAUNCHER or leanback required=true) vs Mobile.

## CLI / Help

Show help:

```powershell
python .\main.py --help
```

```text
Usage: python main.py [--tv|--mobile] [path] [--no-clean] [-h|--help]

Options:
	--tv [path]    Force Android TV mode.
	--mobile       Force Android Mobile mode.
	path           Optional positional path to APK/XAPK/APKM/APKS/ZIP. If omitted, a file dialog opens.
	--no-clean     Keep working folders (session root) instead of removing.
	-h, --help     Show this help and exit.

Behavior:
	Default (no --tv/--mobile) => auto‑detect via manifest: TV if LEANBACK_LAUNCHER or leanback required=true, else Mobile.
	Version source is apktool.yml only (never filename):
	  • Mobile => versionName
	  • TV    => versionName_versionCode
```

## Outputs

| Mode   | JSON                | Credential file                                           | Contains |
|--------|---------------------|-----------------------------------------------------------|----------|
| Mobile | `latest-mobile.json`| `crunchyroll_credentials_mobile_v<versionName>.txt`       | Base64 auth, UA (mobile), versionName |
| TV     | `latest-tv.json`    | `crunchyroll_credentials_tv_v<versionName_versionCode>.txt` | Base64 auth, UA (TV), versionName_versionCode |

Field `auth` = Base64(`client_id:client_secret`).

## Cleanup

By default, the script removes the session working folder.

When you pass `--no-clean`, outputs are retained and renamed for clarity:

```
crunchyroll_[sid]/
	extracted/
		Crunchyroll_[sid].apk
	decompiled/

# After run with --no-clean, renamed to:
crunchyroll_{mobile|tv}_v{version}/
	extracted/
		Crunchyroll_{mobile|tv}_v{version}.apk
	decompiled/
```

## ApkTool

If ApkTool is missing or invalid, it will be downloaded automatically (wrapper + jar) into `apktool/` for Windows & Linux. If already present and valid, the existing files are reused. To supply it manually, place the files in `apktool/`:

Windows:

```
apktool/
	apktool.jar
	apktool.bat   # wrapper for Windows
```

Linux:

```
apktool/
	apktool.jar
	apktool       # wrapper for Linux
```

Get ApkTool jar and wrappers from the official sources:
- Releases (jar): https://github.com/iBotPeaches/Apktool/releases
- Install guide: https://apktool.org/docs/install/

## Purpose

Simplifies updating credentials for tools such as a Crunchyroll Kodi addon. Future reliability is not guaranteed: the logic relies on static regex patterns that may break if the app changes.

## Feature Status

* [x] Windows
* [x] Linux
* [x] Automatic ApkTool installation

## Disclaimer

Provided for educational use only. You are responsible for how you use it.
